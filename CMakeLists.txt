cmake_minimum_required(VERSION 3.2)

# make cmake find our own provided libraries
# the libraries provided here should have higher priority than system libraries
set(CAGE_EXTERNALS_MODULE_PATH "${CMAKE_CURRENT_BINARY_DIR}/cmake-modules")
set(CAGE_EXTERNALS_MODULE_PATH "${CMAKE_CURRENT_BINARY_DIR}/cmake-modules" PARENT_SCOPE)
list(INSERT CMAKE_MODULE_PATH 0 "${CAGE_EXTERNALS_MODULE_PATH}")
include(cage_gen_module.cmake)

# make cmake search for additional programs etc. in the extra folder
# the programs provided here should have higher priority than system programs
list(INSERT CMAKE_PREFIX_PATH 0 "${CMAKE_CURRENT_SOURCE_DIR}/extra")

# some config
set(CMAKE_POSITION_INDEPENDENT_CODE ON)
set(CMAKE_CXX_STANDARD 11)

# disable compilation warnings
if(MSVC)
	string(REPLACE "/W3" "/W0" CMAKE_C_FLAGS ${CMAKE_C_FLAGS})
	string(REPLACE "/W3" "/W0" CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS})
endif()
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -w")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -w")

if(MSVC)
	#disable warnings that some files produced no symbols
	set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -ignore:4221")
	set(CMAKE_STATIC_LINKER_FLAGS "${CMAKE_STATIC_LINKER_FLAGS} -ignore:4221")
endif()

add_subdirectory(zlib)
add_subdirectory(libpng)
add_subdirectory(jpeg)
add_subdirectory(libtiff)
add_subdirectory(devil)
add_subdirectory(freetype)
add_subdirectory(assimp)
add_subdirectory(glad)
add_subdirectory(glm)
add_subdirectory(glfw)
add_subdirectory(libsoundio)
add_subdirectory(dr_libs)
add_subdirectory(ogg)
add_subdirectory(vorbis)
add_subdirectory(utfcpp)
add_subdirectory(simplefilewatcher)
add_subdirectory(msdfgen)
add_subdirectory(xsimd)
add_subdirectory(fastnoise)

add_dependencies(png_static zlib)
add_dependencies(jpeg-static zlib)
add_dependencies(tiff jpeg-static)
add_dependencies(IL jpeg-static tiff png_static)
add_dependencies(freetype png_static)
add_dependencies(assimp IL)
add_dependencies(vorbis ogg)
add_dependencies(lib_msdfgen freetype)

set_target_properties(zlib PROPERTIES FOLDER cage/externals)
set_target_properties(png_static PROPERTIES FOLDER cage/externals)
set_target_properties(genfiles PROPERTIES FOLDER cage/externals)
set_target_properties(jpeg-static PROPERTIES FOLDER cage/externals)
set_target_properties(simd PROPERTIES FOLDER cage/externals)
if (TARGET simd-objs)
	set_target_properties(simd-objs PROPERTIES FOLDER cage/externals)
endif()
set_target_properties(tiff PROPERTIES FOLDER cage/externals)
set_target_properties(IL PROPERTIES FOLDER cage/externals)
set_target_properties(ILU PROPERTIES FOLDER cage/externals)
set_target_properties(freetype PROPERTIES FOLDER cage/externals)
set_target_properties(assimp PROPERTIES FOLDER cage/externals)
set_target_properties(IrrXML PROPERTIES FOLDER cage/externals)
set_target_properties(glad PROPERTIES FOLDER cage/externals)
set_target_properties(glfw PROPERTIES FOLDER cage/externals)
set_target_properties(libsoundio_shared PROPERTIES FOLDER cage/externals)
set_target_properties(dr_libs PROPERTIES FOLDER cage/externals)
set_target_properties(ogg PROPERTIES FOLDER cage/externals)
set_target_properties(vorbis PROPERTIES FOLDER cage/externals)
set_target_properties(vorbisenc PROPERTIES FOLDER cage/externals)
set_target_properties(vorbisfile PROPERTIES FOLDER cage/externals)
set_target_properties(simplefilewatcher PROPERTIES FOLDER cage/externals)
set_target_properties(lib_msdfgen PROPERTIES FOLDER cage/externals)
set_target_properties(fastnoise PROPERTIES FOLDER cage/externals)

